{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  created() {\n    if (this.$route.params.quartzId == 'all') {\n      this.jobId = 0;\n    } else if (this.$route.params.quartzId !== null) {\n      this.jobId = this.$route.params.quartzId;\n    }\n    if (this.jobId == this.$store.state.pageState.quartzLog.jobId) {\n      this.current = this.$store.state.pageState.quartzLog.current;\n    } else {\n      this.current = 1;\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      });\n    }\n    this.listJobLogs();\n    this.listJobGroups();\n  },\n  data() {\n    return {\n      loading: true,\n      current: 1,\n      size: 10,\n      count: 0,\n      open: false,\n      jobId: 0,\n      jobLog: {},\n      searchParams: {},\n      jobGroups: [],\n      jobLogIds: [],\n      jobLogs: [],\n      dateRange: []\n    };\n  },\n  methods: {\n    selectionChange(jobLogs) {\n      this.jobLogIds = [];\n      jobLogs.forEach(item => {\n        this.jobLogIds.push(item.id);\n      });\n    },\n    listJobGroups() {\n      this.axios.get('/api/admin/jobLogs/jobGroups').then(({\n        data\n      }) => {\n        this.jobGroups = data.data;\n      });\n    },\n    listJobLogs() {\n      if (this.jobId === 0) {\n        this.searchParams.jobId = null;\n      } else {\n        this.searchParams.jobId = this.jobId;\n      }\n      this.searchParams.current = this.current;\n      this.searchParams.size = this.size;\n      this.searchParams.startTime = this.dateRange[0];\n      this.searchParams.endTime = this.dateRange[1];\n      this.axios.get('/api/admin/jobLogs', {\n        params: this.searchParams\n      }).then(({\n        data\n      }) => {\n        this.jobLogs = data.data.records;\n        this.count = data.data.count;\n        this.loading = false;\n      });\n    },\n    searchLogs() {\n      this.current = 1;\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      });\n      this.listJobLogs();\n    },\n    clearSearch() {\n      this.searchParams = {};\n      this.dateRange = [];\n      this.listJobLogs();\n    },\n    sizeChange(size) {\n      this.size = size;\n      this.listJobLogs();\n    },\n    currentChange(current) {\n      this.current = current;\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      });\n      this.listJobLogs();\n    },\n    deleteJobLogs() {\n      let param = {};\n      param = {\n        data: this.jobLogIds\n      };\n      this.axios.delete('/api/admin/jobLogs', param).then(({\n        data\n      }) => {\n        if (data.flag) {\n          this.$notify.success({\n            title: '成功',\n            message: '删除成功'\n          });\n          this.listJobLogs();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: '删除失败'\n          });\n        }\n      });\n    },\n    clean() {\n      this.axios.delete('/api/admin/jobLogs/clean').then(({\n        data\n      }) => {\n        if (data.flag) {\n          this.$notify.success({\n            title: '成功',\n            message: '清空成功'\n          });\n          this.listJobLogs();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: '清空失败'\n          });\n        }\n      });\n    },\n    changeOpen(jobLog) {\n      this.jobLog = jobLog;\n      this.jobLog.exceptionInfo = '\\n' + this.jobLog.exceptionInfo;\n      this.open = true;\n      this.$nextTick(() => {\n        Prism.highlightAll();\n      });\n    }\n  }\n};","map":{"version":3,"names":["created","$route","params","quartzId","jobId","$store","state","pageState","quartzLog","current","commit","listJobLogs","listJobGroups","data","loading","size","count","open","jobLog","searchParams","jobGroups","jobLogIds","jobLogs","dateRange","methods","selectionChange","forEach","item","push","id","axios","get","then","startTime","endTime","records","searchLogs","clearSearch","sizeChange","currentChange","deleteJobLogs","param","delete","flag","$notify","success","title","message","error","clean","changeOpen","exceptionInfo","$nextTick","Prism","highlightAll"],"sources":["src/views/log/QuartzLog.vue"],"sourcesContent":["<template>\r\n  <el-card class=\"main-card\">\r\n    <el-form :inline=\"true\" ref=\"form\" label-width=\"68px\">\r\n      <el-row>\r\n        <el-form-item label=\"任务名称\">\r\n          <el-input\r\n            style=\"width: 200px\"\r\n            size=\"small\"\r\n            v-model=\"searchParams.jobName\"\r\n            placeholder=\"请输入任务名称\"\r\n            @keyup.enter.native=\"listJobLogs\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"任务组名\">\r\n          <el-select\r\n            size=\"small\"\r\n            @change=\"listJobLogs\"\r\n            clearable\r\n            style=\"margin-left: 5px\"\r\n            v-model=\"searchParams.jobGroup\"\r\n            placeholder=\"请选择组名\">\r\n            <el-option v-for=\"jobGroup in jobGroups\" :key=\"jobGroup\" :label=\"jobGroup\" :value=\"jobGroup\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"执行状态\">\r\n          <el-select\r\n            size=\"small\"\r\n            @change=\"listJobLogs\"\r\n            clearable\r\n            style=\"margin-left: 5px\"\r\n            v-model=\"searchParams.status\"\r\n            placeholder=\"请选择任务状态\">\r\n            <el-option value=\"1\" label=\"成功\" />\r\n            <el-option value=\"0\" label=\"失败\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"执行时间\">\r\n          <el-date-picker\r\n            size=\"small\"\r\n            v-model=\"dateRange\"\r\n            type=\"daterange\"\r\n            range-separator=\"至\"\r\n            start-placeholder=\"开始日期\"\r\n            end-placeholder=\"结束日期\">\r\n          </el-date-picker>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" icon=\"el-icon-search\" size=\"small\" @click=\"searchLogs\">查找</el-button>\r\n          <el-button icon=\"el-icon-refresh\" size=\"small\" @click=\"clearSearch\">重置</el-button>\r\n        </el-form-item>\r\n      </el-row>\r\n    </el-form>\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <el-col :span=\"1.5\">\r\n        <el-button :disabled=\"!jobLogIds.length\" type=\"danger\" icon=\"el-icon-delete\" size=\"small\" @click=\"deleteJobLogs\"\r\n          >批量删除\r\n        </el-button>\r\n      </el-col>\r\n      <el-col :span=\"1.5\">\r\n        <el-button type=\"danger\" icon=\"el-icon-delete\" size=\"small\" @click=\"clean\">清空</el-button>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <el-table\r\n      :default-sort=\"{ prop: 'createTime', order: 'descending' }\"\r\n      style=\"width: 100%\"\r\n      :data=\"jobLogs\"\r\n      v-loading=\"loading\"\r\n      @selection-change=\"selectionChange\">\r\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\r\n      <el-table-column label=\"日志编号\" width=\"80\" align=\"center\" prop=\"id\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.$index + 1 }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"任务名称\" align=\"center\" prop=\"jobName\" :show-overflow-tooltip=\"true\" />\r\n      <el-table-column label=\"任务组名\" align=\"center\" prop=\"jobGroup\" :show-overflow-tooltip=\"true\">\r\n        <template slot-scope=\"scope\">\r\n          <el-tag>\r\n            {{ scope.row.jobGroup }}\r\n          </el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"调用目标字符串\" align=\"center\" prop=\"invokeTarget\" :show-overflow-tooltip=\"true\" />\r\n      <el-table-column label=\"日志信息\" align=\"center\" prop=\"jobMessage\" :show-overflow-tooltip=\"true\" />\r\n      <el-table-column label=\"执行状态\" align=\"center\" prop=\"status\">\r\n        <template slot-scope=\"scope\">\r\n          <el-tag v-if=\"scope.row.status === 1\" type=\"success\">成功</el-tag>\r\n          <el-tag v-if=\"scope.row.status === 0\" type=\"danger\">失败</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"执行时间\" align=\"center\" prop=\"createTime\" width=\"180\">\r\n        <template slot-scope=\"scope\">\r\n          <span>{{ scope.row.startTime | dateTime }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button size=\"mini\" type=\"text\" icon=\"el-icon-view\" @click=\"changeOpen(scope.row)\">详细</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <el-pagination\r\n      class=\"pagination-container\"\r\n      background\r\n      @size-change=\"sizeChange\"\r\n      @current-change=\"currentChange\"\r\n      :current-page=\"current\"\r\n      :page-size=\"size\"\r\n      :total=\"count\"\r\n      :page-sizes=\"[10, 20]\"\r\n      layout=\"total, sizes, prev, pager, next, jumper\" />\r\n    <el-dialog\r\n      title=\"调度日志详细\"\r\n      :visible.sync=\"open\"\r\n      :width=\"jobLog.status == 1 ? '700px' : '80%'\"\r\n      append-to-body\r\n      destroy-on-close>\r\n      <el-form ref=\"form\" :model=\"jobLog\" label-width=\"100px\" size=\"mini\">\r\n        <el-row>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"日志序号：\">{{ jobLog.id }}</el-form-item>\r\n            <el-form-item label=\"任务名称：\">{{ jobLog.jobName }}</el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"任务分组：\">{{ jobLog.jobGroup }}</el-form-item>\r\n            <el-form-item label=\"执行时间：\">{{ jobLog.startTime | dateTime }}</el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"24\">\r\n            <el-form-item label=\"调用方法：\">{{ jobLog.invokeTarget }}</el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"24\">\r\n            <el-form-item label=\"日志信息：\">{{ jobLog.jobMessage }}</el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"24\">\r\n            <el-form-item label=\"执行状态：\">\r\n              <div v-if=\"jobLog.status === 1\">成功</div>\r\n              <div v-else-if=\"jobLog.status === 0\">失败</div>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col v-if=\"jobLog.status == 0\" :span=\"24\">\r\n            <div>\r\n              <pre>\r\n\t\t<code class=\"language-java\">{{ jobLog.exceptionInfo }}</code>\r\n\t      </pre>\r\n            </div>\r\n          </el-col>\r\n        </el-row>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"open = false\">关闭</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </el-card>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  created() {\r\n    if (this.$route.params.quartzId == 'all') {\r\n      this.jobId = 0\r\n    } else if (this.$route.params.quartzId !== null) {\r\n      this.jobId = this.$route.params.quartzId\r\n    }\r\n    if (this.jobId == this.$store.state.pageState.quartzLog.jobId) {\r\n      this.current = this.$store.state.pageState.quartzLog.current\r\n    } else {\r\n      this.current = 1\r\n      this.$store.commit('updateQuartzLogPageState', {\r\n        jobId: this.jobId,\r\n        current: this.current\r\n      })\r\n    }\r\n    this.listJobLogs()\r\n    this.listJobGroups()\r\n  },\r\n  data() {\r\n    return {\r\n      loading: true,\r\n      current: 1,\r\n      size: 10,\r\n      count: 0,\r\n      open: false,\r\n      jobId: 0,\r\n      jobLog: {},\r\n      searchParams: {},\r\n      jobGroups: [],\r\n      jobLogIds: [],\r\n      jobLogs: [],\r\n      dateRange: []\r\n    }\r\n  },\r\n  methods: {\r\n    selectionChange(jobLogs) {\r\n      this.jobLogIds = []\r\n      jobLogs.forEach((item) => {\r\n        this.jobLogIds.push(item.id)\r\n      })\r\n    },\r\n    listJobGroups() {\r\n      this.axios.get('/api/admin/jobLogs/jobGroups').then(({ data }) => {\r\n        this.jobGroups = data.data\r\n      })\r\n    },\r\n    listJobLogs() {\r\n      if (this.jobId === 0) {\r\n        this.searchParams.jobId = null\r\n      } else {\r\n        this.searchParams.jobId = this.jobId\r\n      }\r\n      this.searchParams.current = this.current\r\n      this.searchParams.size = this.size\r\n      this.searchParams.startTime = this.dateRange[0]\r\n      this.searchParams.endTime = this.dateRange[1]\r\n      this.axios\r\n        .get('/api/admin/jobLogs', {\r\n          params: this.searchParams\r\n        })\r\n        .then(({ data }) => {\r\n          this.jobLogs = data.data.records\r\n          this.count = data.data.count\r\n          this.loading = false\r\n        })\r\n    },\r\n    searchLogs() {\r\n      this.current = 1\r\n      this.$store.commit('updateQuartzLogPageState', {\r\n        jobId: this.jobId,\r\n        current: this.current\r\n      })\r\n      this.listJobLogs()\r\n    },\r\n    clearSearch() {\r\n      this.searchParams = {}\r\n      this.dateRange = []\r\n      this.listJobLogs()\r\n    },\r\n    sizeChange(size) {\r\n      this.size = size\r\n      this.listJobLogs()\r\n    },\r\n    currentChange(current) {\r\n      this.current = current\r\n      this.$store.commit('updateQuartzLogPageState', {\r\n        jobId: this.jobId,\r\n        current: this.current\r\n      })\r\n      this.listJobLogs()\r\n    },\r\n    deleteJobLogs() {\r\n      let param = {}\r\n      param = { data: this.jobLogIds }\r\n      this.axios.delete('/api/admin/jobLogs', param).then(({ data }) => {\r\n        if (data.flag) {\r\n          this.$notify.success({\r\n            title: '成功',\r\n            message: '删除成功'\r\n          })\r\n          this.listJobLogs()\r\n        } else {\r\n          this.$notify.error({\r\n            title: '失败',\r\n            message: '删除失败'\r\n          })\r\n        }\r\n      })\r\n    },\r\n    clean() {\r\n      this.axios.delete('/api/admin/jobLogs/clean').then(({ data }) => {\r\n        if (data.flag) {\r\n          this.$notify.success({\r\n            title: '成功',\r\n            message: '清空成功'\r\n          })\r\n          this.listJobLogs()\r\n        } else {\r\n          this.$notify.error({\r\n            title: '失败',\r\n            message: '清空失败'\r\n          })\r\n        }\r\n      })\r\n    },\r\n    changeOpen(jobLog) {\r\n      this.jobLog = jobLog\r\n      this.jobLog.exceptionInfo = '\\n' + this.jobLog.exceptionInfo\r\n      this.open = true\r\n      this.$nextTick(() => {\r\n        Prism.highlightAll()\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped></style>\r\n"],"mappings":";AA4JA;EACAA,QAAA;IACA,SAAAC,MAAA,CAAAC,MAAA,CAAAC,QAAA;MACA,KAAAC,KAAA;IACA,gBAAAH,MAAA,CAAAC,MAAA,CAAAC,QAAA;MACA,KAAAC,KAAA,QAAAH,MAAA,CAAAC,MAAA,CAAAC,QAAA;IACA;IACA,SAAAC,KAAA,SAAAC,MAAA,CAAAC,KAAA,CAAAC,SAAA,CAAAC,SAAA,CAAAJ,KAAA;MACA,KAAAK,OAAA,QAAAJ,MAAA,CAAAC,KAAA,CAAAC,SAAA,CAAAC,SAAA,CAAAC,OAAA;IACA;MACA,KAAAA,OAAA;MACA,KAAAJ,MAAA,CAAAK,MAAA;QACAN,KAAA,OAAAA,KAAA;QACAK,OAAA,OAAAA;MACA;IACA;IACA,KAAAE,WAAA;IACA,KAAAC,aAAA;EACA;EACAC,KAAA;IACA;MACAC,OAAA;MACAL,OAAA;MACAM,IAAA;MACAC,KAAA;MACAC,IAAA;MACAb,KAAA;MACAc,MAAA;MACAC,YAAA;MACAC,SAAA;MACAC,SAAA;MACAC,OAAA;MACAC,SAAA;IACA;EACA;EACAC,OAAA;IACAC,gBAAAH,OAAA;MACA,KAAAD,SAAA;MACAC,OAAA,CAAAI,OAAA,CAAAC,IAAA;QACA,KAAAN,SAAA,CAAAO,IAAA,CAAAD,IAAA,CAAAE,EAAA;MACA;IACA;IACAjB,cAAA;MACA,KAAAkB,KAAA,CAAAC,GAAA,iCAAAC,IAAA;QAAAnB;MAAA;QACA,KAAAO,SAAA,GAAAP,IAAA,CAAAA,IAAA;MACA;IACA;IACAF,YAAA;MACA,SAAAP,KAAA;QACA,KAAAe,YAAA,CAAAf,KAAA;MACA;QACA,KAAAe,YAAA,CAAAf,KAAA,QAAAA,KAAA;MACA;MACA,KAAAe,YAAA,CAAAV,OAAA,QAAAA,OAAA;MACA,KAAAU,YAAA,CAAAJ,IAAA,QAAAA,IAAA;MACA,KAAAI,YAAA,CAAAc,SAAA,QAAAV,SAAA;MACA,KAAAJ,YAAA,CAAAe,OAAA,QAAAX,SAAA;MACA,KAAAO,KAAA,CACAC,GAAA;QACA7B,MAAA,OAAAiB;MACA,GACAa,IAAA;QAAAnB;MAAA;QACA,KAAAS,OAAA,GAAAT,IAAA,CAAAA,IAAA,CAAAsB,OAAA;QACA,KAAAnB,KAAA,GAAAH,IAAA,CAAAA,IAAA,CAAAG,KAAA;QACA,KAAAF,OAAA;MACA;IACA;IACAsB,WAAA;MACA,KAAA3B,OAAA;MACA,KAAAJ,MAAA,CAAAK,MAAA;QACAN,KAAA,OAAAA,KAAA;QACAK,OAAA,OAAAA;MACA;MACA,KAAAE,WAAA;IACA;IACA0B,YAAA;MACA,KAAAlB,YAAA;MACA,KAAAI,SAAA;MACA,KAAAZ,WAAA;IACA;IACA2B,WAAAvB,IAAA;MACA,KAAAA,IAAA,GAAAA,IAAA;MACA,KAAAJ,WAAA;IACA;IACA4B,cAAA9B,OAAA;MACA,KAAAA,OAAA,GAAAA,OAAA;MACA,KAAAJ,MAAA,CAAAK,MAAA;QACAN,KAAA,OAAAA,KAAA;QACAK,OAAA,OAAAA;MACA;MACA,KAAAE,WAAA;IACA;IACA6B,cAAA;MACA,IAAAC,KAAA;MACAA,KAAA;QAAA5B,IAAA,OAAAQ;MAAA;MACA,KAAAS,KAAA,CAAAY,MAAA,uBAAAD,KAAA,EAAAT,IAAA;QAAAnB;MAAA;QACA,IAAAA,IAAA,CAAA8B,IAAA;UACA,KAAAC,OAAA,CAAAC,OAAA;YACAC,KAAA;YACAC,OAAA;UACA;UACA,KAAApC,WAAA;QACA;UACA,KAAAiC,OAAA,CAAAI,KAAA;YACAF,KAAA;YACAC,OAAA;UACA;QACA;MACA;IACA;IACAE,MAAA;MACA,KAAAnB,KAAA,CAAAY,MAAA,6BAAAV,IAAA;QAAAnB;MAAA;QACA,IAAAA,IAAA,CAAA8B,IAAA;UACA,KAAAC,OAAA,CAAAC,OAAA;YACAC,KAAA;YACAC,OAAA;UACA;UACA,KAAApC,WAAA;QACA;UACA,KAAAiC,OAAA,CAAAI,KAAA;YACAF,KAAA;YACAC,OAAA;UACA;QACA;MACA;IACA;IACAG,WAAAhC,MAAA;MACA,KAAAA,MAAA,GAAAA,MAAA;MACA,KAAAA,MAAA,CAAAiC,aAAA,eAAAjC,MAAA,CAAAiC,aAAA;MACA,KAAAlC,IAAA;MACA,KAAAmC,SAAA;QACAC,KAAA,CAAAC,YAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}